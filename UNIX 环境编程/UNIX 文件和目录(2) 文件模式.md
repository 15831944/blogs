# 1. 概述

文件类型, 文件访问权限, 设置用户ID, 设置组ID, 粘着位, 都包含在文件模式字 st_mode 成员中

## 1. 宏定义

| macro   | value    | 说明 |
| ------- | -------- | ---------------------------------- |
| S_ISREG(st_mode)   |  |  |
| S_ISDIR(st_mode)   | (((mode)&S_IFMT)==S_IFDIR) | |
| S_ISLINK(st_mode)  |  |  |
| S_ISBLK(st_mode)   |  |  |
| S_ISCHR(st_mode)   |  |  |
| S_ISSOCK(st_mode)  |  |  |
| S_ISFIFO(st_mode)  |  |  |

## 2. st_mode 屏蔽

| st_mode | value    | 说明 |
| ------- | -------- | ---------------------------------- |
| S_IFDIR            |       | 目录文件 |
| S_ISUID            | 04000 | 文件的（set user-id on execution）位 |
| S_ISGID            | 02000 | 文件的（set group-id on execution）位 |
| S_ISVTX            | 01000 | 文件的sticky位 |
| S_IRUSR, S_IREAD   | 00400 | 文件所有者具可读取权限 |
| S_IWUSR, S_IWRITE  | 00200 | 文件所有者具可写入权限 |
| S_IXUSR, S_IEXEC   | 00100 | 文件所有者具可执行权限 |
| S_IRGRP            | 00040 | 用户组具可读取权限 |
| S_IWGRP            | 00020 | 用户组具可写入权限 |
| S_IXGRP            | 00010 | 用户组具可执行权限 |
| S_IROTH            | 00004 | 其他用户具可读取权限 |
| S_IWOTH            | 00002 | 其他用户具可写入权限 |
| S_IXOTH            | 00001 | 其他用户具可执行权限 |

# 2. 文件类型

7种文件类型

| 文件类型 | 符号 | 说明 |
| --------------------------------- | -- | -------------------------- |
| 普通文件(regular file)              | - |  |
| 目录文件(directory file)            | d |  |
| 符号链接(symbolic link)             | l |   |
| 块特殊文件(block special file)       | b | 对设备带缓冲访问, 每次访问长度不变 |
| 字符特殊文件(character special file) | c | 对设备不带缓冲访问, 每次访问长度可变 |
| 套接字(socket)                      | s |  |
| 命名管道(named pipe, FIFO)          | p |  |

3个进程间通信(IPC)对象

| IPC 对象类型 | 宏 |
| ---------- | ------------------ |
| 消息队列    | S_TYPEISSMQ(stat*) |
| 信号量      | S_TYPEISSEM(stat*) |
| 共享存储对象 | S_TYPEISSHM(stat*) |

# 3. 设置ID位

设置用户 ID (set-user-ID)和设置组 ID(set-group-ID)

设置用户ID: 当执行此文件时, 将进程的有效用户 ID 设置为文件所有者的用户 ID(st_uid)

设置组 ID: 当执行此文件时, 将进程的有效组 ID 设置为文件的组所有者 ID

超级用户之所以能够访问其他用户的文件, 就是因为使用了设置用户 ID 功能

## ID 类型

于一个进程相关的 ID 有6个

| ID 类型 | 说明 |
| --------------- | -------------- |
| 实际用户 ID      | 我们登录的实际身份 |
| 实际组 ID        |  |
| 有效用户 ID      | 用于文件访问权限检查 |
| 有效组 ID        |  |
| 附属组 ID        |  |
| 保存的设置用户 ID | 执行 exec 函数时保存有效用户 ID 和有效组 ID 的副本 |
| 保存的设置组 ID   |  |

# 4. 文件权限

文件和目录的权限的含义

| 操作 | 含义 |
| ------- | ---------- |
| 读文件   | 读取文件内容 |
| 写文件   | 编辑文件内容（新增和修改文件内容，而不是文件本身）|
| 执行文件 | 执行二进制文件 |
| 读目录   | 读取目录结构列表（目录项，文件名），例如 ls 命令 |
| 写目录   | 更改目录结构列表（新建文件，删除文件，移动文件，修改文件名） |
| 执行目录 | 进入此目录，成为工作目录，例如 cd 命令 |

## 文件权限检查过程


# 5. 参考

《UNIX 环境高级编程》

《鸟哥的 Linux 私房菜》
