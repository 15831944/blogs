# 文件句柄的概念

文件句柄 file handle 是 windows 下的概念

句柄是指向具体对象或(数据块)的描述符的指针

也就是说有一块内存区域保存了最终数据，而为了对这个数据进行操作，我们需要针对其构造一个描述结构体，这个结构体称为描述符，而这个描述符的指针就是句柄

一个句柄就是你给一个文件，设备，管套(socket)或管道的一个名字, 以便帮助你记住你正处理的名字, 并隐藏某些缓存等的复杂性

文件句柄是 HANDLE 类型的，比如创建文件 CreateFile 返回一个 HANDLE 型的值

在 Windows 中，句柄是一个系统内部数据结构的引用。

例如，当你操作一个窗口，或说是一个 Delphi 窗体时，系统会给你一个该窗口的句柄

系统会通知你：你正在操作142号窗口，就此，你的应用程序就能要求系统对142号窗口进行操作——移动窗口、改变窗口大小、把窗口极小化为图标，等等。

实际上许多 Windows API 函数把句柄作为它的第一个参数，如GDI（图形设备接口）句柄、菜单句柄、实例句柄、位图句柄等等，不仅仅局限于窗口函数。

换句话说，句柄是一种内部代码，通过它能引用受系统控制的特殊元素，如窗口、位图、图标、内存块、光标、字体、菜单等等。 

文件句柄本质上是一个指向指针的指针

# 为什么需要使用句柄？

应用程序启动后，组成这个程序的各对象是住留在内存的

Windows 是一个以虚拟内存为基础的操作系统

Windows 内存管理器经常在内存中来回移动对象，依此来满足各种应用程序的内存需要

对象被移动意味着它的地址会发生变化

Windows 为各应用程序腾出一些内存储地址，用来专门登记各应用对象在内存中的地址变化

而这个地址(存储单元的位置)本身是不变的

Windows 内存管理器在移动对象在内存中的位置后，把对象新的地址告知这个句柄地址来保存

这样我们只需记住这个句柄地址就可以间接地知道对象具体在内存中的哪个位置

这个地址是在对象装载(Load)时由系统分配的

当系统卸载时(Unload)又释放给系统

windows 程序中并不是用物理地址来标识一个内存块，文件，任务或动态装入模块的

windows API 给这些项目分配确定的句柄，并将句柄返回给应用程序，然后通过句柄来进行操作


[文件描述符，文件句柄的区别？](http://bbs.csdn.net/topics/230035323)

[文件句柄是什么意思](http://zhidao.baidu.com/question/35001537.html)
