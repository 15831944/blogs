# 指向基本数据类型的指针

指向整型变量的指针变量

1. 指向整型变量的指针类型的变量

```
int			*p;				// 指针
```

指向整型常量的指针变量

1. p可变, 指针的内容，即指向的地址可变，即该指针可以指向另一个整型常量，但指向的这些整型值都是不可变的
2. \*p不可变, const 限定符修饰的是*p, 即指向的i的值, 是间接访问到的那个变量的值, 不能通过该指针修改, 但不影响该变量本身是变量或常量, 通过变量名修改其值
3. 指向变量的指针不可以去指向常量, 因为对指针进行间接访问去修改常量的值是不允许的
4. 小权限的指针可以指向(访问)大权限的变量, 即指向常量的指针(读权限)可以指向变量(读写权限)
5. 指向常量的指针作为函数参数可以防止传入的指针参数被修改, 指针作为函数参数时, 小权限的形参可以指向(传入)大权限的实参, 因为函数内部是对小权限进行操作的

```
const int	i;				// 这里 i 不用 const 修饰也可以
const int	*p = &i;		// 指向常量的指针, 指向的数据对象可以是常量, 也可以是变量
int const	*p = &i;
```

指向整型变量的指针常量

1. p不可变, 指针的内容，即指向的地址是字面值或常量，是不变的, const 限定符修饰的是 p 本身, 即指针本身不能变, 只能指向一个地址(变量)
2. \*p可变, 指向的整型值可变。
3. 使用字面值形式的指针常量时, 一般只会用于已知的设备地址，否则程序中一般无法了解一个变量的具体地址。使用时应使用强制类型转换，将整数转换为指针类型。
4. 数组是矢量类型的数据，数组名本质上是一个指针常量，因此数组元素可以利用指针运算进行访问。

```
int *const	p;				// 指针常量
(int *)		0xff2044ec;		// 设备I/O地址
(int *)		0x0;			// NULL 指针
int			array[];		// 数组
```

指向整型常量的指针常量

1. 指针内容不变，指针指向的内容也不变。

```
int const *const	p;		// 指向常量的指针常量
const int *const	p;
```

# 指向复合数据类型的指针

指向数组的指针

1. 注意区分指针数组和指向数组的指针，前者是数组元素是指针的数组, 后者是指向数组的指针。

```
int		matrix[3][10];		// 二维数组名是一个指向数组的指针常量
int		(*p)[10] = matrix;	// 操作数 p 先进行聚组中的间接访问，说明它是一个指针，再进行下标引用，说明指向的是一个整型数组
```

指向结构的指针

1. 结构和数组的区别在于，结构是一个标量，也就是需要通过名字来访问。结构不能够像数组那样进行指针运算和按地址访问。
2. 当结构作为函数参数时，进行的是传值调用，如果结构很庞大，会造成很大的开销。因此应该用指向结构的指针作为函数参数。

```
struct tag	structname;
struct tag	*p = &structname;
```

指向函数的指针

1. 函数名称本质上跟数组名类似，也是一个指针。
2. 指向函数的指针有两个常见用途，一是转换表(jump table)，二是回调函数(callback function)。

```
int (*f)();		// 操作数 f 先进行间接访问，表示 f 是一个指针，再进行函数调用操作，表示 f 这个指针指向的是一个函数，这个函数返回整型值
int (*f[])();	// 操作数 f 是一个数组，数组元素是指针，指针指向的是函数，函数的返回类型是整型
int *(*f[])();	// 与前者的唯一区别是，函数的返回类型是指向整型的指针
```

指向指针的指针

1. 如果指向指针的指针 ppi 是静态变量，那么在声明后，ppi 的值为0, ppi 被初始化后，才可以对 ppi 进行间接访问。

```
int		i;
int		*pi = &i;		// pi 指向变量 i，*pi 的内容是变量 i 的值
int		**ppi = &pi;	// ppi 指向 pi，*ppi 的内容是变量 i 的地址, **ppi 的内容是变量 i 的值
```

# 指针表达式

1. 指针的内容是指针所指向的地址，间接访问(解引用)操作符\*访问的是指向的这个地址，\*p作为左值时，就是这个位置，作为右值时，就是这个位置的值
2. 指针是一个地址, 因此指针的的大小总是计算机的字长, 指针的类型决定访问这个地址的方式

```
char	c = ‘a’;
char	*p = &c;
```

| 表达式    | 右值           | 左值          | 对p的副作用    | 对c的副作用       |
| -------- | -------------- | ------------ | ------------ | --------------- |
| p        | p的内容(c的地址) | p的地址       |              |                 |
| &p       | p的地址         |              |              |                 |
| *p       | c的内容         | c的地址       |              |                 |
| *p + 1   | c的内容+1       |              |              |                 |
| *(p + 1) | c后面位置的内容  | c后面位置的地址 |              |                 |
| ++p      | c后面位置的地址  |              | c后面位置的地址 |                 |
| p++      | c的地址         |              | c后面位置的地址 |                 |
| *++p     | c后面位置的内容  | c后面位置的地址 | c后面位置的地址 |                 |
| *p++     | c的内容         |  c的地址      | c后面位置的地址 |                 |
| ++*p     | c的内容+1       |              |               | c的内容+1       |
| (*p)++   | c的内容         |              |               | c的内容+1       |
| ++*++p   | c后面位置的内容+1 |             | c后面位置的地址 | c后面位置的内容+1 |
| ++*p++   | c的内容+1       |              | c后面位置的地址 | c的内容+1        |

# 参考

Kenneth A. Reek 著《C 和指针》
